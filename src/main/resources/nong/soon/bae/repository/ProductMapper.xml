<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nong.soon.bae.repository.ProductMapper">

	<!-- 내 이름 가져오기 -->
	<select id="selectMyName" parameterType="String" resultType="String">
		select name from users where username=#{username}
	</select>

	<!-- 내 상점 정보 등록하기 -->
	<insert id="shopListInsert" parameterType="nong.soon.bae.bean.ShopListDTO">
		insert into shoplist (username, shopName, shopContent, regDate, address) 
	    values (
	        #{username},
	        #{shopName}, 
	        #{shopContent}, 
	        sysdate,
	        #{address} )
	</insert>	

	<!-- 내 상점 테이블 만들기 -->
	<insert id="createProduct" parameterType="String">
		create table ${username}_product (
			optionNum varchar2(50) primary Key not null,
			username varchar2(50) not null,
			productNum varchar2(50) not null,
			optionName varchar2(200) not null,
			price number not null,
			productCount number not null,
			sellCount number not null )
	</insert>
	
	<!-- FINISH -->
	
	<!-- TEST -->
	
	<!-- 상품 등록하기 -->
	<insert id="productInsert" parameterType="nong.soon.bae.bean.AllProductDTO">
		insert into allproduct (productnum, productname, username, content, startdate,
		enddate, cate1, cate2, cate3, area1, area2)
		values (
			TO_NUMBER(TO_CHAR(SYSDATE, 'YY') || ${catenum} || LPAD(${seqnum}_seq.nextval, 5, '0')), 
			#{productname},
			#{username},
			#{content},
			sysdate,
			#{enddate},
			1,
			1,
			1,
			#{area1},
			#{area2} )
	</insert>
	
	<!-- 상점에 대한 주소 가져오는 코드 -->
	<select id="selectArea" resultType="nong.soon.bae.bean.AreaDTO" parameterType="String">
		SELECT SL.Address, A.AREA1, A.AREA2 FROM SHOPLIST SL
		JOIN AREA A ON SL.Address LIKE '%' || A.areaname || '%'
		where SL.username=#{username}
	</select>
	
	<!-- 가장 최근의 상품번호값 없으면 카운트0 있으면 상품 수 -->
	<select id="selectLastProductNumCnt" parameterType="String" resultType="int">
		select count(*) from allproduct WHERE productnum LIKE #{keyword}
	</select>
	
	<!-- 상품번호가 있으면 상품번호 뽑아오는거 -->
	<select id="selectLastProductNum" parameterType="String" resultType="nong.soon.bae.bean.AllProductDTO">
		select * from allproduct WHERE productnum LIKE #{keyword}
	</select>
	
	<!-- 상품 등록할 때 이미지 넣기 -->
	<insert id="imagesInsert" parameterType="nong.soon.bae.bean.ImagesDTO">
		insert into ${username}_images values (
			#{productnum},
			#{username},
			#{filename} )
	</insert>
	
	
</mapper>    
    
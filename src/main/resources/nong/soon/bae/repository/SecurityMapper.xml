<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nong.soon.bae.repository.SecurityMapper">
    
    <resultMap type="nong.soon.bae.bean.UsersDTO" id="memberMap">
	    <id property="username" column="username"/>
	    <result property="username" column="username"/>
	    <result property="password" column="password"/>
	    <result property="name" column="name"/>
	    <result property="email" column="email"/>
	    <result property="birth" column="birth"/>
	    <result property="gender" column="gender"/>
	    <result property="grade" column="grade"/>
	    <collection property="gradenames" resultMap="authMap">
	    </collection> 
	  </resultMap>
	  <resultMap type="nong.soon.bae.bean.UserGradeDTO" id="authMap">
	    <result property="gradenum" column="gradenum"/>
	    <result property="gradename" column="gradename"/>
	  </resultMap>
	  
	  <resultMap type="nong.soon.bae.bean.KakaoUsersDTO" id="kakaoMap">
	    <id property="username" column="username"/>
	    <result property="username" column="username"/>
	    <result property="password" column="password"/>
	    <result property="nickname" column="nickname"/>
	    <result property="name" column="name"/>
	    <result property="email" column="email"/>
	    <result property="birth" column="birth"/>
	    <result property="phone" column="phone"/>
	    <result property="gender" column="gender"/>
	    <result property="grade" column="grade"/>
	    <collection property="gradenames" resultMap="authMap">
	    </collection> 
	  </resultMap>
    
	<select id="login" resultMap="memberMap">
		select * from users u, usergrade g where u.username=#{username} and u.grade=g.gradenum
	</select>
	
	<insert id="kakaoInsert" >
    	INSERT INTO kakaousers values (#{username}, #{nickname}, #{name}, 100, #{email}, #{phone}, #{birth}, #{gender}, #{password})
	</insert>
	
	<select id="read" resultMap="kakaoMap">
		select * from kakaousers where username=#{username}
	</select>
	
</mapper>    
    
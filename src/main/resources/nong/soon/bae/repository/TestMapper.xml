<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nong.soon.bae.repository.TestMapper">
	<select id="count" resultType="int">
		select count(*) from users
	</select>
	<select id="findUsers" parameterType="String" resultType="nong.soon.bae.bean.UsersDTO">
		select * from users where username=#{username}
	</select>
	<select id="userChatList" parameterType="String" resultType="chatDTO">
		SELECT
		    chat.*,
		    users.name AS username_name,
		    receiver_users.name AS sendname_name,
		    udetails.image AS username_img,
		    sdetails.image AS sendname_img
		FROM chat
		JOIN users ON chat.username = users.username
		JOIN users receiver_users ON chat.sendname = receiver_users.username
		JOIN userdetails udetails ON chat.username = udetails.username
		JOIN userdetails sdetails ON chat.sendname = sdetails.username
		WHERE chat.username = #{username}
	</select>
	<select id="chatInfo">
		SELECT
		    chat.*,
		    users.name AS username_name,
		    receiver_users.name AS sendname_name,
		    udetails.image AS username_img,
		    sdetails.image AS sendname_img
		FROM chat
		JOIN users ON chat.username = users.username
		JOIN users receiver_users ON chat.sendname = receiver_users.username
		JOIN userdetails udetails ON chat.username = udetails.username
		JOIN userdetails sdetails ON chat.sendname = sdetails.username
		WHERE chat.chatno = #{chatno} AND chat.username = #{username}
	</select>
	<select id="findChat" resultType="chatDTO">
		select * from chat where username=#{username} and chatno=#{chatno}
	</select>
	<select id="findSenduser" resultType="chatDTO">
		select * from chat where sendname=#{username} and chatno=#{chatno}
	</select>
	<update id="updateNoRead">
		update chat set noread=#{cnt} where chatno=#{chatno} and sendname=#{username}
	</update>
	<update id="zeroNoRead">
		update chat set noread=0 where chatno=#{chatno} and username=#{username}
	</update>
	<update id="updateJoinCnt">
		update chat set isjoin=#{joincnt} where chatno=#{chatno}
	</update>
	<select id="findAddCartCnt" parameterType="String" resultType="int">
		select count(*) from ${username}_mypage where wishstatus=3
	</select>
	<select id="findAddCartSeller" parameterType="String" resultType="String">
		select distinct follow from ${username}_mypage where wishstatus=3
	</select>
	<select id="findAddCart" resultType="myPageDTO">
		SELECT cart.*, pl.price, pl.optionname
		FROM ${username}_mypage cart
		JOIN ${seller}_product pl 
		ON cart.productnum = pl.productnum 
		AND cart.optionnum = pl.optionnum
		WHERE cart.wishstatus = 3
	</select>
	<insert id="insertUsersPayment" parameterType="paymentDTO">
		insert into ${username}_payment(username, productnum, optionnum, realprice, totalprice, quantity)
		values(#{username}, #{productnum}, #{optionnum}, #{realprice}, #{totalprice}, #{quantity})
	</insert>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nong.soon.bae.repository.MainMapper">
	
	<select id="seasonCategoryCnt" parameterType="String" resultType="int">
		<![CDATA[
			select count(*) from productcategory where cate3>0 and month like #{keyword}
		]]>
	</select>
	
	<select id="seasonCategory" parameterType="hashmap" resultType="nong.soon.bae.bean.ProductCategoryDTO">
		<![CDATA[
			select * from 
			(select c.* , rownum r from 
			(select * from productcategory where cate3>0 
			and month like #{keyword} order by readcount) c) 
			where r >= #{start} and r <= #{end}
		]]>
	</select>
	
	<select id="findCatename" parameterType="hashmap" resultType="String">
		select catename from productcategory where cate1=#{cate1} and cate2=#{cate2} and cate3=#{cate3}
	</select>
	
	<select id="seasonProductCnt" parameterType="hashmap" resultType="int">
		select count(*) from allproduct where cate1=#{cate1} and cate2=#{cate2} and cate3=#{cate3}
	</select>
	
	<select id="seasonProduct" parameterType="hashmap" resultType="nong.soon.bae.bean.AllProductDTO">
		select * from allproduct where cate1=#{cate1} and cate2=#{cate2} and cate3=#{cate3}
	</select>
	
	<select id="isChart" parameterType="hashmap" resultType="int">
		select count(*) from chart where name=#{catename}
	</select>
	
	<select id="productChart" parameterType="hashmap" resultType="double">
		select avg(avgprice) from chart where regdate like #{keyword} and name=#{catename}
	</select>
	
	<select id="maxAvgPrice" parameterType="String" resultType="int">
		select max(avgprice) from chart where name=#{catename}
	</select>
	
	<select id="chartCategory" parameterType="hashmap" resultType="nong.soon.bae.bean.ProductCategoryDTO">
		<![CDATA[
			select * from 
			(select c.* , rownum r from 
			(select * from productcategory 
			where cate1=#{cate1} and cate3>0 
			order by cate2 asc, cate3 asc) c) 
			where r >= #{start} and r <= #{end}
		]]>
	</select>
	
	<select id="chartCategoryCnt" parameterType="String" resultType="int">
		select count(*) from productcategory where cate1=#{cate1} and cate3>0
	</select>
	
	<select id="cateMenu" resultType="nong.soon.bae.bean.ProductCategoryDTO">
		<![CDATA[
			select * from productcategory where cate1>0 and cate2=0
		]]>
	</select>
	
	<select id="nextCate" parameterType="hashmap" resultType="nong.soon.bae.bean.ProductCategoryDTO">
		<![CDATA[
			select * from 
			(select c.* , rownum r from 
			(select * from productcategory 
			where cate1=#{cate1} and cate3>0 
			order by cate2 asc, cate3 asc) c) 
			where r = #{start}
		]]>
	</select>
	
	<select id="searchProductCnt" parameterType="String" resultType="int">
		select count(*) from allproduct where productname like #{keyword}
	</select>
	
	<select id="searchProduct" parameterType="hashmap" resultType="nong.soon.bae.bean.AllProductDTO">
		<![CDATA[
			select * from 
			(select a.* , rownum r from 
			(select * from allproduct 
			where productname like #{keyword}) a) 
			where r >= #{start} and r <= #{end}
		]]>
	</select>
	
	<resultMap type="nong.soon.bae.bean.UsersDTO" id="memberMap">
	    <id property="username" column="username"/>
	    <result property="username" column="username"/>
	    <result property="password" column="password"/>
	    <result property="name" column="name"/>
	    <result property="email" column="email"/>
	    <result property="birth" column="birth"/>
	    <result property="gender" column="gender"/>
	    <result property="regsite" column="regsite"/>
	    <collection property="grade" resultMap="authMap">
	    </collection> 
	  </resultMap>
	  <resultMap type="nong.soon.bae.bean.UserGradeDTO" id="authMap">
	    <result property="grade" column="grade"/>
	    <result property="username" column="username"/>
	  </resultMap>
	
	<select id="isMembership" parameterType="String" resultMap="memberMap">
		select * from users where username=#{username}
	</select>
</mapper>